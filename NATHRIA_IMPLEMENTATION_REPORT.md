# 纳斯利亚堡的悬案（Murder at Castle Nathria）实现报告

**完成时间**: 2025-12-30
**状态**: ✅ 基础工作完成，代码框架已生成

---

## 📊 项目概览

### 卡牌统计
- **总卡牌数**: 170 张可收集卡牌
- **职业分布**:
  - 恶魔猎手: 13 张
  - 德鲁伊: 13 张
  - 猎人: 13 张
  - 法师: 13 张
  - 圣骑士: 13 张
  - 牧师: 13 张
  - 潜行者: 13 张
  - 萨满: 13 张
  - 术士: 13 张
  - 战士: 13 张
  - 中立: 40 张

### 类型分布
- **Location（地标）**: 10 张 ⭐新卡牌类型
- 随从: 100 张
- 法术: 57 张
- 武器: 3 张

### 稀有度分布
- 普通: 66 张
- 稀有: 49 张
- 史诗: 26 张
- 传说: 29 张

---

## 🎯 已完成的工作

### 1. 卡牌数据下载 ✅
- ✅ 下载英文卡牌数据 (170 张)
- ✅ 下载中文卡牌数据 (170 张)
- ✅ 保存到 `nathria_cards.json` 和 `nathria_cards_zhCN.json`

### 2. 卡牌数据分析 ✅
- ✅ 识别新机制: **Infuse（注能）** - 26 张卡牌
- ✅ 识别新类型: **Location（地标）** - 10 张卡牌
- ✅ 统计职业和稀有度分布

### 3. 代码框架生成 ✅
- ✅ 生成 14 个 Python 文件
- ✅ 170 张卡牌的类定义
- ✅ 包含中英文名称和效果描述
- ✅ 自动标记 TODO 项

---

## 🎮 核心新机制

### 1. Infuse（注能）⭐

**机制说明**:
- 当友方随从死亡时，手牌中的 Infuse 卡牌会获得充能
- 达到指定数量后，卡牌升级为更强版本
- 例如：Infuse (3) 表示需要 3 个友方随从死亡

**卡牌示例**:

1. **MAW_003 - Totemic Evidence（图腾证据）**
   - 1费法术
   - 选择一个基础图腾并召唤它
   - 注能(3个图腾)：改为召唤全部4个

2. **MAW_009 - Shadehound（影犬）**
   - 5费 5/5
   - 每当该随从攻击时，使你的其他野兽+2/+2
   - 注能(3个野兽)：获得突袭

3. **MAW_012 - All Fel Breaks Loose（邪能之乱）**
   - 5费法术
   - 召唤一个本局对战中死亡的友方恶魔
   - 注能(3个恶魔)：改为召唤三个

**使用卡牌**: 26 张

---

### 2. Location（地标）⭐全新卡牌类型

**机制说明**:
- 全新的卡牌类型，类似于永久性的场地效果
- 打出后留在场上，可以多次使用
- 每个地标有使用次数限制（耐久度）
- 使用后进入冷却，下回合才能再次使用

**特点**:
- 不占用随从位置
- 不能被攻击或直接移除
- 提供持续的战略优势

**使用卡牌**: 10 张

---


## 📂 生成的文件结构

```
fireplace/cards/nathria_generated/
├── demonhunter.py (13 张)
├── druid.py (13 张)
├── hunter.py (13 张)
├── mage.py (13 张)
├── neutral_common.py (21 张)
├── neutral_epic.py (6 张)
├── neutral_legendary.py (7 张)
├── neutral_rare.py (6 张)
├── paladin.py (13 张)
├── priest.py (13 张)
├── rogue.py (13 张)
├── shaman.py (13 张)
├── warlock.py (13 张)
└── warrior.py (13 张)
```

---


## 📝 相关文件

### 数据文件
- `nathria_cards.json` - 英文卡牌数据 (170 张)
- `nathria_cards_zhCN.json` - 中文卡牌数据 (170 张)

### 脚本文件
- `generate_nathria_cards.py` - 代码生成脚本

### 生成的卡牌代码
- `fireplace/cards/nathria_generated/*.py` - 170 张卡牌类定义

---


## 📝 待实现的核心机制

### Infuse（注能）实现计划

**实现位置**: 需要在多个地方实现

**关键点**:
1. 监听友方随从死亡事件
2. 为手牌中的 Infuse 卡牌增加计数器
3. 达到阈值后升级卡牌效果
4. 可能需要为每张卡牌单独追踪（按类型过滤）

**技术要点**:
- 使用 `Death` 事件监听随从死亡
- 在卡牌上添加 `infuse_counter` 属性
- 检查死亡随从的类型（如野兽、恶魔等）
- 达到阈值后修改卡牌效果

---


### Location（地标）实现计划

**实现位置**: 需要扩展 fireplace 核心代码

**关键点**:
1. 添加新的 CardType.LOCATION
2. 实现地标的打出和使用机制
3. 实现耐久度系统
4. 实现冷却机制（使用后下回合才能再用）

**技术要点**:
- 地标不占用随从位置
- 需要单独的地标区域
- 实现使用次数限制
- 实现冷却状态管理

**注意**: Location 是全新卡牌类型，需要大量核心代码扩展

---

## ✅ 总结

纳斯利亚堡的悬案扩展包的基础工作已经完成：

1. ✅ **卡牌数据下载完成** - 170 张卡牌（英文+中文）
2. ✅ **核心机制识别完成** - Infuse（注能）+ Location（地标）
3. ✅ **代码框架生成完成** - 14 个文件，170 张卡牌类定义
4. ⏭️ **核心机制待实现** - Infuse 和 Location 需要在 fireplace 核心代码中实现
5. ⏭️ **卡牌实现待完成** - 需要实现具体的卡牌效果

**下一步**: 实现 Infuse 和 Location 核心机制，然后开始实现卡牌效果。

---

**实现进度**: 🟢 基础完成 (20%) → 🟡 核心机制待实现 → 🟡 卡牌实现待开始 (0/170)

