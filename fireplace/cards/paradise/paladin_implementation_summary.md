# Paradise 圣骑士卡牌实现总结

## 实现概览

**完成时间**: 2026-01-06
**实现进度**: 13/13 (100%)

## 卡牌列表

### COMMON (5张)

1. **WORK_002 - 忙碌机器人** (2费 3/2 机械)
   - **效果**: 战吼：使你攻击力为1的随从获得+1/+1
   - **实现**: 遍历场上所有攻击力为1的友方随从，给予+1/+1 buff

2. **VAC_921 - 沙滩排槌** (3费武器 3/2)
   - **效果**: 在你的英雄攻击后，获取一张法力值消耗为(1)的防晒霜
   - **实现**: 监听英雄攻击事件，触发后给予防晒霜Token
   - **Token**: VAC_921t (防晒霜 - 1费法术，使随从+1/+2)

3. **VAC_917 - 烧烤大师** (4费 3/4)
   - **效果**: 战吼：抽取你法力值消耗最低的牌。亡语：抽取你法力值消耗最高的牌
   - **实现**: 使用 `min()`/`max()` 找到牌库中费用最低/最高的牌，使用 `Draw()` 抽取

4. **WORK_003 - 假期规划** (4费法术)
   - **效果**: 恢复#4点生命值。召唤3个白银之手新兵。抽两张牌
   - **实现**: 组合 `Heal()`, `Summon()`, `Draw()` 三个action

5. **VAC_915 - 大力扣杀** (6费圣光法术)
   - **效果**: 造成$4点伤害。随机使一个友方随从获得+4/+4
   - **实现**: `Hit()` 造成伤害，随机选择友方随从给予+4/+4 buff

### RARE (4张)

6. **VAC_916 - 神圣佳酿** (1费圣光Drink Spell)
   - **效果**: 使一个角色获得圣盾。（还剩3杯！）
   - **实现**: Drink Spell机制 - 使用后返回2杯版本(VAC_916t)
   - **Tokens**: 
     - VAC_916t (2杯版本)
     - VAC_916t2 (1杯版本，最后一次)

7. **VAC_922 - 救生光环** (1费圣光法术)
   - **效果**: 在你的回合结束时，获取一张防晒霜。持续3回合
   - **实现**: 给玩家添加Player Enchantment，监听回合结束事件，倒计时3回合

8. **VAC_919 - 救生员** (4费 2/7 嘲讽)
   - **效果**: 战吼：你施放的下一个法术拥有吸血
   - **实现**: 给玩家添加Player Enchantment，监听施放法术事件，给法术添加吸血标签

9. **WORK_001 - 信任背摔** (4费法术)
   - **效果**: 发现两张法力值消耗≤(5)的随从牌，使其获得彼此的攻击力和生命值
   - **实现**: 两次 `Discover()`，记录属性值，交换并应用buff

### EPIC (2张)

10. **VAC_920 - 王牌发球手** (2费 2/3)
    - **效果**: 在本随从获得攻击力后，使你手牌中法力值消耗最高的牌减少(1)费
    - **实现**: 监听 `Buff()` 事件，检查是否获得攻击力，找到手牌最高费牌减费

11. **VAC_558 - 海上船歌** (10费法术)
    - **效果**: 召唤三个5/5的海盗。每对角色施放一个法术，本牌减少(1)费
    - **实现**: 
      - 召唤3个5/5海盗Token
      - **需要核心扩展**: 追踪 `spells_cast_on_characters_this_game`
    - **Token**: VAC_558t (5/5海盗)

### LEGENDARY (2张)

12. **VAC_507 - 阳光汲取者莱妮莎** (5费 2/6)
    - **效果**: 潜行者游客。你的法力值消耗≤(2)的法术会施放两次
    - **实现**: 监听施放法术事件，如果费用≤2，再施放一次（防止无限循环）
    - **Tourist机制**: 构筑规则，不影响游戏逻辑

13. **VAC_923 - 圣沙泽尔** (5费 3/8 元素 突袭)
    - **效果**: 在本随从攻击后，变成地标
    - **地标效果**: 使一个友方随从获得+3攻击力和突袭，然后变回随从
    - **实现**: 
      - 随从形态：监听攻击事件，`Morph()` 变形为地标
      - 地标形态：给予+3攻击和突袭，`Morph()` 变回随从
    - **Token**: VAC_923t (地标形态)

## Token 定义

所有Token已在 `tokens.py` 中定义：

1. **VAC_921t** - 防晒霜 (1费法术，+1/+2)
2. **VAC_921te** - 防晒霜增益效果
3. **VAC_916t** - 神圣佳酿 (2杯)
4. **VAC_916t2** - 神圣佳酿 (1杯)
5. **VAC_558t** - 海盗 (5/5)
6. **VAC_923t** - 圣沙泽尔地标形态
7. **VAC_923te** - 圣沙泽尔地标增益效果 (+3攻击+突袭)

## 核心机制

### 1. Drink Spell 机制
- **实现方式**: 使用后通过 `Give()` 返回减少次数的版本
- **版本链**: 原版(3杯) → t(2杯) → t2(1杯) → 不再返回
- **参考**: VAC_520 (法师的银樽海韵)

### 2. Tourist 机制
- **VAC_507**: 潜行者游客
- **实现**: 构筑规则验证（在Deck Validation中实现）
- **游戏效果**: 法术施放两次（通过监听事件实现）

### 3. 随从变形地标机制
- **VAC_923**: 随从 ↔ 地标双向变形
- **实现**: 使用 `Morph()` action
- **生命值共享**: 随从生命值 = 地标耐久度

## 需要核心扩展

### ✅ Player 类扩展 (player.py) - 已完成

已添加追踪对角色施放法术的属性：

```python
# 追踪本局游戏对角色施放的法术数量（用于VAC_558海上船歌等卡牌）- 胜地历险记（2024年7月）
self.spells_cast_on_characters_this_game = 0
```

### ✅ Game 类扩展 (actions.py) - 已完成

已在 Play action 中添加追踪逻辑：

```python
# 追踪对角色施放的法术数量（用于VAC_558海上船歌等卡牌）- 胜地历险记（2024年7月）
if card.type == CardType.SPELL and target:
    # 检查目标是否为角色（英雄或随从）
    if target.type in [CardType.HERO, CardType.MINION]:
        source.spells_cast_on_characters_this_game += 1
```

## 实现质量

- ✅ **完整中文注释**: 所有卡牌和Token都有详细的中英文注释
- ✅ **符合项目规范**: 遵循现有代码风格和命名规范
- ✅ **官方数据验证**: 通过Web搜索验证了关键卡牌效果（如VAC_923地标效果）
- ✅ **无简化实现**: 所有机制都完整实现，无妥协方案
- ✅ **核心引擎扩展**: 已完成 `spells_cast_on_characters_this_game` 追踪机制

## 下一步

1. ✅ **扩展核心引擎**: 已添加 `spells_cast_on_characters_this_game` 追踪 - **完成**
2. ⬜ **官方数据验证**: 对所有13张卡牌进行完整的官方数据验证
3. ⬜ **测试验证**: 编写单元测试验证卡牌效果的正确性
