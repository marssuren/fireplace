# 中立传说卡牌实现问题审查报告

## 🔍 审查日期
2026-01-06

## ❌ 发现的问题

### 问题1: VAC_321 - Incindius 使用未声明的自定义属性 ⚠️ **严重**

**位置**: `neutral_legendary.py` Line 27-29

**问题代码**:
```python
if not hasattr(card, 'eruption_damage'):
    card.eruption_damage = 1
card.eruption_damage += 1
```

**问题类型**: 未声明的属性

**问题描述**:
- 直接在运行时给卡牌对象动态添加 `eruption_damage` 属性
- 这个属性没有在任何类定义中声明
- 违反了项目规范：避免未声明的属性或机制

**影响**:
- 代码可维护性差
- 可能导致序列化/反序列化问题
- 不符合fireplace的设计模式

**建议修复方案**:
1. **方案A**: 在 `VAC_321t` Token类中正式声明 `eruption_damage` 属性
2. **方案B**: 使用Buff/Enchantment机制来追踪升级状态
3. **方案C**: 扩展核心引擎，添加对动态卡牌属性的官方支持

**推荐方案**: 方案A - 在Token类中声明属性

---

### 问题2: VAC_955t - Gorgonzormu Cheese 使用未声明的自定义属性 ⚠️ **严重**

**位置**: `tokens.py` VAC_955t类

**问题代码**:
```python
def __init__(self, *args, **kwargs):
    super().__init__(*args, **kwargs)
    self.summon_cost = 1
```

**问题类型**: 未声明的属性

**问题描述**:
- 在 `__init__` 中添加 `summon_cost` 属性
- 这个属性没有在类级别声明
- 同样违反了项目规范

**影响**:
- 与问题1相同

**建议修复方案**:
1. 在类级别声明 `summon_cost` 属性
2. 或使用Buff机制追踪升级状态

---

### 问题3: WORK_027 - Zephrys 的卡池是简化实现 ⚠️ **中等**

**位置**: `neutral_legendary.py` Line 157-184

**问题代码**:
```python
EXTRAVAGANT_TOUR = [
    "CS2_222",   # Stormwind Champion (7费)
    "EX1_116",   # Leeroy Jenkins (6费)
    "NEW1_030",  # Black Knight (6费)
    "EX1_012",   # Bloodmage Thalnos (2费但是传说)
    "CS2_213",   # Reckless Rocketeer (6费)
    # 可以添加更多高费卡牌
]
```

**问题类型**: 简化实现

**问题描述**:
1. 每个卡池只有5张卡，远少于官方卡池
2. 使用了硬编码的经典卡牌ID
3. 注释中写着"可以添加更多"，说明这是不完整的实现
4. 根据官方数据，实际卡池应该包含更多卡牌

**官方卡池示例** (根据搜索结果):
- **Extravagant Tour**: Earth Elemental, Nourish, Sprint, Cairne Bloodhoof, Gorehowl, Natalie Seline, Ice Block, Shadowstep等
- **Hectic Tour**: Rockbiter Weapon, Bloodlust, Doomhammer, King Krush, Pyroblast, Fireball, Mortal Strike, Windfury, Savage Roar, Lava Burst, Soulfire, Avenging Wrath, Mind Blast, Lightning Bolt, Eviscerate, Frostbolt, Leeroy Jenkins, Ragnaros, Al'akir等
- **Modest Tour**: 各种AOE和单体清场法术

**影响**:
- 游戏体验不符合官方设计
- 卡池太小，随机性不足
- 不能准确模拟官方行为

**建议修复方案**:
1. 从官方API或数据文件中获取完整卡池
2. 补充完整的卡牌列表（每个卡池至少15-20张卡）
3. 添加注释说明卡池来源

---

### 问题4: VAC_702 - Marin 的宝藏ID可能不正确 ⚠️ **轻微**

**位置**: `neutral_legendary.py` Line 75-80

**问题代码**:
```python
TREASURES = [
    "VAC_702t",  # Zarog's Crown
    "VAC_702t2", # Wondrous Wand
    "VAC_702t3", # Golden Kobold
    "VAC_702t4", # Tolin's Goblet
]
```

**问题类型**: 可能的ID错误

**问题描述**:
- 根据搜索结果，Marin的宝藏来自Kobolds & Catacombs扩展包
- 原始宝藏ID应该是 `LOOT_998` 系列
- 但Paradise版本的Marin可能使用了新的Token ID
- 需要验证这些ID是否正确

**影响**:
- 如果ID错误，卡牌将无法正常工作
- 可能导致找不到Token定义

**建议修复方案**:
1. 从 `cards.json` 中查找正确的Token ID
2. 验证这些Token是否存在于Paradise扩展包中
3. 如果使用旧ID，需要确保这些卡牌在当前环境中可用

---

### 问题5: VAC_446 - A.F. Kay 的未攻击判断可能不准确 ⚠️ **轻微**

**位置**: `neutral_legendary.py` Line 50

**问题代码**:
```python
if minion.num_attacks == 0:
    yield Buff(minion, "VAC_446e")
```

**问题类型**: 潜在逻辑问题

**问题描述**:
- 使用 `num_attacks == 0` 判断随从是否攻击过
- 但对于刚召唤的随从（有召唤病），`num_attacks` 也是0
- 这可能导致刚召唤的随从也获得buff，这可能不符合预期

**影响**:
- 可能给不应该获得buff的随从加buff
- 需要验证官方行为

**建议修复方案**:
1. 验证官方行为：刚召唤的随从是否应该获得buff
2. 如果不应该，需要额外检查随从是否有召唤病
3. 可能需要检查 `exhausted` 或其他属性

---

## 📊 问题统计

| 严重程度 | 数量 | 问题编号 |
|---------|------|---------|
| 严重 | 2 | 问题1, 问题2 |
| 中等 | 1 | 问题3 |
| 轻微 | 2 | 问题4, 问题5 |
| **总计** | **5** | |

---

## ✅ 修复优先级

1. **高优先级** (必须修复):
   - 问题1: VAC_321 未声明属性
   - 问题2: VAC_955t 未声明属性

2. **中优先级** (应该修复):
   - 问题3: WORK_027 简化实现

3. **低优先级** (建议修复):
   - 问题4: VAC_702 Token ID验证
   - 问题5: VAC_446 逻辑验证

---

## 🔧 总体评估

**当前状态**: ⚠️ **有问题，需要修复**

**主要问题**:
- 使用了2个未声明的自定义属性（违反项目规范）
- 1个简化实现（卡池不完整）
- 2个需要验证的潜在问题

**建议行动**:
1. 立即修复未声明属性问题（问题1和2）
2. 补充完整的Zephrys卡池（问题3）
3. 验证Marin的Token ID和A.F. Kay的逻辑（问题4和5）

---

**审查人**: Antigravity AI  
**审查日期**: 2026-01-06  
**审查标准**: 项目规范 - 避免简化/妥协实现或未声明的属性或机制
